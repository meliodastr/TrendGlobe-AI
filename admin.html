<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrendGlobe | YÃ¶netici Paneli</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { background: #020617; color: white; font-family: sans-serif; }
        .ai-gradient { background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%); }
        .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
    </style>
</head>
<body class="p-6 md:p-12">
    <div class="max-w-2xl mx-auto glass p-8 rounded-[2.5rem]">
        <h1 class="text-3xl font-black mb-2 tracking-tighter uppercase italic">
            Trend <span class="text-indigo-500">YÃ¼kleme Merkezi</span>
        </h1>
        <p class="text-gray-400 text-sm mb-8 font-medium italic">Yapay zeka destekli trend analizi ve yayÄ±nlama paneli.</p>
        
        <div class="space-y-6">
            <div>
                <label class="block text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-2 ml-1">Trend BaÅŸlÄ±ÄŸÄ±</label>
                <input id="title" type="text" placeholder="Ã–rn: Minimalist Ev Ofis AkÄ±mÄ±" 
                    class="w-full bg-black/40 border border-white/10 p-4 rounded-2xl outline-none focus:border-indigo-500 transition">
            </div>

            <div>
                <label class="block text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-2 ml-1">Video veya GÃ¶rsel URL (.mp4 veya .jpg)</label>
                <input id="mediaUrl" type="text" placeholder="https://v16-webapp.tiktok.com/..." 
                    class="w-full bg-black/40 border border-white/10 p-4 rounded-2xl outline-none focus:border-indigo-500 transition">
            </div>

            <div>
                <label class="block text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-2 ml-1">Kategori</label>
                <select id="category" class="w-full bg-black/40 border border-white/10 p-4 rounded-2xl outline-none cursor-pointer">
                    <option value="TikTok Viral">TikTok Viral</option>
                    <option value="E-Ticaret">E-Ticaret</option>
                    <option value="Yapay Zeka">Yapay Zeka</option>
                    <option value="Finans">Finans</option>
                </select>
            </div>

            <button onclick="aiAnalizYap()" id="btn" 
                class="w-full py-5 ai-gradient rounded-3xl font-black text-lg shadow-xl shadow-indigo-500/20 hover:scale-[1.01] transition active:scale-95">
                AI ANALÄ°ZÄ° YAP VE YAYINLA ðŸš€
            </button>

            <div id="status" class="text-center text-sm font-bold min-h-[20px] pt-2"></div>
        </div>
    </div>

    <script>
        // --- AYARLAR ---
        const SUPABASE_URL = 'https://vcd6z_anjrrylfklscn.supabase.co'; 
        const SUPABASE_KEY = 'sb_publishable_vcD6Z_aNjRRyLfklScn_Bw_R9xkKkIr'; 
        const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        async function aiAnalizYap() {
            const btn = document.getElementById('btn');
            const status = document.getElementById('status');
            const title = document.getElementById('title').value;
            const mediaUrl = document.getElementById('mediaUrl').value;
            const category = document.getElementById('category').value;

            // Form kontrolÃ¼
            if(!title || !mediaUrl) {
                status.innerHTML = "<span class='text-amber-500'>LÃ¼tfen boÅŸ alan bÄ±rakmayÄ±n.</span>";
                return;
            }

            // ArayÃ¼z kilitleme
            btn.disabled = true;
            btn.style.opacity = "0.5";
            status.innerHTML = "<span class='text-indigo-400 animate-pulse'>Yapay Zeka analiz ediyor ve yayÄ±nlanÄ±yor...</span>";

            try {
                // 1. ADIM: VERCEL API'SÄ°NDEN AI ANALÄ°ZÄ° AL
                const aiResponse = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ title, category })
                });

                if(!aiResponse.ok) throw new Error("Yapay zeka servisi yanÄ±t vermedi.");
                
                const aiData = await aiResponse.json();
                const yapayZekaYorumu = aiData.analysis;

                // 2. ADIM: SUPABASE'E KAYDET
                const { error } = await _supabase.from('trends').insert([
                    {
                        title: title,
                        video_url: mediaUrl,
                        category: category,
                        ai_analysis: yapayZekaYorumu,
                        growth_rate: "+%" + Math.floor(Math.random() * 250 + 40)
                    }
                ]);

                if(error) throw error;

                // BaÅŸarÄ± durumu
                status.innerHTML = "<span class='text-green-500'>âœ… BAÅžARILI: Trend ana sayfada yayÄ±nda!</span>";
                
                // Formu temizle
                document.getElementById('title').value = "";
                document.getElementById('mediaUrl').value = "";

            } catch (err) {
                console.error(err);
                status.innerHTML = "<span class='text-red-500'>Hata: " + err.message + "</span>";
            } finally {
                btn.disabled = false;
                btn.style.opacity = "1";
            }
        }
    </script>
</body>
</html>
