<script>
    const _supabase = supabase.createClient('https://vcd6z_anjrrylfklscn.supabase.co', 'sb_publishable_vcD6Z_aNjRRyLfklScn_Bw_R9xkKkIr');

    async function trendEkle() {
        const title = document.getElementById('title').value;
        const mediaUrl = document.getElementById('mediaUrl').value;
        const status = document.getElementById('status');

        if(!title || !mediaUrl) return alert("BoÅŸ alan bÄ±rakma!");

        status.innerText = "ğŸ¤– AI Analiz Ediyor...";
        
        try {
            // 1. ADIM: OpenAI Analizini Al
            const res = await fetch('/api/analyze', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ title, category: 'Global' })
            });
            
            const data = await res.json();
            if(!res.ok) throw new Error(data.error || "API baÄŸlantÄ± hatasÄ±");

            // 2. ADIM: Supabase'e Kaydet
            const { error } = await _supabase.from('trends').insert([{
                title: title,
                video_url: mediaUrl,
                ai_analysis: data.analysis,
                category: 'Global'
            }]);

            if(error) throw error;
            status.innerText = "âœ… BaÅŸarÄ±yla yÃ¼klendi!";
        } catch (err) {
            status.innerText = "âŒ HATA: " + err.message;
        }
    }
</script>
